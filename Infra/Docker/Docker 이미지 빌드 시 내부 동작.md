# Docker 이미지 빌드 시 동작과정

### 1.**Dockerfile의 실행 원리**

- Dockerfile 내의 코드는 `docker build` 명령어 실행 시 내 컴퓨터에서 **실제로** 명령어들을 단계별로 실행
- 각 명령어 실행 결과는 Docker 이미지의 레이어로 저장되며, 최종적으로 이 레이어들이 합쳐져 하나의 이미지를 형성

1. **호스트 시스템과 Docker 이미지의 분리**:
   - Dockerfile 내 명령어는 Docker 컨테이너 내에서 실행되며, 호스트 시스템에는 영향을 주지 않습니다.
   - ex 1) `RUN apt install -y python3`는 Docker 이미지 내에서만 Python3를 설치하며, 호스트 시스템에는 설치되지 않습니다.
   - ex 2) `WORKDIR /var/www/html`는 이미지 내의 작업 디렉토리를 설정합니다. 이 디렉토리는 컨테이너 내부에만 존재하며 호스트 시스템에는 영향을 주지 않습니다.
2. **Docker 빌드 과정과 임시 컨테이너**:
   - `docker build` 과정 중, Dockerfile의 지시문을 실행하기 위해 임시 컨테이너가 생성되고 사용된 후 자동으로 삭제됩니다. 이 과정에서 생성된 최종 이미지만이 남으며, 임시 컨테이너는 모두 사라 짐

### 2. 베이스 이미지의 역할

-  각 스테이지에서 사용하는 베이스 이미지는 해당 스테이지의 작업을 수행하기 위한 환경을 제공합니다.
- 예시로, JDK 베이스 이미지를 사용하면 해당 스테이지에서  JDK를 사용할 수 있음(java 파일의 컴파일을 수행할 수 있음) 또. gradle의 베이스 이미지를 사용하면 해당 스테이지에서 Gradle을 사용할 수 있음(Spring 프로젝트를 빌드할 수 있음)

### 3. Dockerfile 내 `CMD`와 `ENTRYPOINT` 명령어

1. **`CMD`와 `ENTRYPOINT`의 역할**:
   - `CMD`와 `ENTRYPOINT` 지시자는 `docker build` 과정에서 실행되지 않습니다. 이 명령어들은 Docker 이미지에 포함되어 있으며, 이미지를 바탕으로 컨테이너가 실행될 때 실제로 실행됩니다.
4. **실행 시점의 유연성**:
   - `CMD`와 `ENTRYPOINT`를 통해 Docker 이미지는 특정 애플리케이션을 실행하기 위한 모든 필요한 설정과 종속성을 포함하면서도, 실제 실행 시점에 다양한 방식으로 사용될 수 있는 유연성을 제공합니다.

### 3. 핵심 요약

- **이미지 빌드를 위해 docker build 명령어를 사용하면 dockerfile에 작성된 코드를 실제로 컴퓨터에서 실행시킴. 하지만, 임시 컨테이너를 생성하고 그 내부에서 dockerfile 명령어들이 실행되기 때문에 내 컴퓨터와의 충돌 없이 독립적으로 실행할 수 있음. dockerfile 명령어들이 전부 실행되고 이미지 빌드가 끝나면 최종 이미지만 남고 임시 컨테이너는 종료되고 삭제됨**

- `docker build` 과정에서 `RUN` 지시자를 통한 명령어 실행은 이미지 레이어 생성에 직접적으로 관여합니다. 반면, `CMD`와 `ENTRYPOINT`는 컨테이너 실행 시에만 영향을 미치며, Docker 이미지 빌드 시에는 실행되지 않습니다.
