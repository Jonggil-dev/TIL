# 로깅 전략

- ### **로깅 전략에 대한 고민 부분 프로젝트 TIL에 기록 남겨놓기**

- **수정 전**

  - 로그의 종류가 너무 다양 하고 많아서, 관리를 도대체 어떻게 해야 할 지 모르겠음

  - stacktrace, debug와 같은 로그들도 직접 elasticsearch로 수집을 해야되는건지, 수집을 한다해도 일부 출력 형태가 다른 로그들에 대해 전처리를 어떻게 해야 될지 잘 모르겠음.

    

-  **수정 후 : 로깅 레벨을 동적으로 조정 + 로그를 정리해서 관리 하기 위한 전략**

  1. **Spring Actuator를 이용해 운영 중 로깅 레벨을 동적으로 변경한다.**
     1. INFO 이상 로그는 기본으로 저장하고,
  
     2. 필요시 DEBUG나 TRACE 로그도 저장할 수 있게 동적 로깅 제어가 가능해야 한다.
  
  2. **Filebeat는 모든 로그를 기록하고 수집한다.**
     1. filebeat는 기본적으로 로깅 레벨을 필터링하거나 조정하는 도구가 아님
     2. 로깅 레벨에 대한 조정은 actuator를 이용하고 로그에 대한 필터나 전처리는 logstash를 이용
  
  3. **Logstash에서 로깅 레벨별로 전처리를 하여 Elasticsearch에 저장될 로그를 제어한다.**
  
  



- **수정 사항**

  - Spring Boot
    - elasticsearch에서 로그 필드를 인덱스로 관리하기 위해 LoggingFilter 코드 수정
      - Map 형 자료구조를 사용해서 JSON으로 로그를 출력함

    - logback.xml 수정(트랜젝션 ID 추가 및 콘솔 패턴 삭제(기본 동작에 맡김))
    - Actuator 설정 추가 (동적 로깅 레벨 관리)
    
    
    
  - logstash 전처리과정 추가



