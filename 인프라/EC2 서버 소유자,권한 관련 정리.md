# EC2 서버 소유자,권한 관련 정리

- ### Linux 시스템에서 파일/폴더는 소유자와 권한을 가지고 있음

  - `ls -la`나 `ll` 명령어를 통해 해당 파일의 소유자와 권한을 확인할 수 있음 (자세한 건 인터넷 참고)
  - **중요한 건 도커 컨테이너를 실행할 때 EC2의 디렉토리와 볼륨마운트를 하는 경우임**
    - **편의상 A를 호스트(EC2) 디렉토리,  B를 마운트된 도커 컨테이너의 내부 디렉토리라고 지칭 함**
    - 이 때 A를 B에 마운트 하는 경우에 B의 소유자, 권한은 A의 설정을 따라가게 됨
    - 그래서 jenkins를 통해 파일의 쓰기(복사)를 할 때, A의 설정이 jenkins를 허용하지 않는다면 jenkins가 작업을 수행할 수 없음
    - 이 때 방법이 2가지 해결 방법이 있는데
      - **첫 번째는 A의 소유자와 권한을 변경하는 방법(마운트가 되어 있기에, B의 소유자와 권한도 함께 변경 됨)**
        - 이 경우 호스트(EC2) 환경에서 그냥 A의 소유자/권한을 바꿔버리는 거임
        - 그런데 jenkins가 도커 컨테이너 내부에 있기 때문에 독립된 환경에 존재 하기 때문에, 호스트(EC2)에서 jenkins 계정을 인지 하지 못함
        - 그래서 호스트에서 jenkins 계정을 별도로 생성한 뒤에 처리해야 됨 (인터넷 참고)
      - **두 번째는 B의 소유자와 권한을 변경하는 방법 (마운트가 되어 있기에, A의 소유자와 권한도 함께 변경 됨)**
        - 이 경우 도커 컨테이너 내부에 접속해서 B의 소유자나 권한을 바꿔버리는 거임
        -  그런데, 도커 컨테이너의 계정이 현재 B의 설정 권한(마운트로 인해 결국 A의 설정 권한과 같음) 보다 낮다면 B의 소유자,권한을 수정하지 못함. 
        - 이 경우에는 도커 컨테이너를 root 계정으로 접속해서(-u root 옵션 사용) B의 소유자나 권한을 바꾸면 됨