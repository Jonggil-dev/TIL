# CORS 동작 원리

### ✔CORS(Cross-Origin Resource Sharing) 기본 이해

- CORS는 웹 브라우저가 다른 출처의 리소스에 안전하게 접근할 수 있도록 하는 보안 메커니즘입니다.
- 웹 브라우저는 **서버로부터 받은 응답의 CORS 관련 헤더(`Access-Control-Allow-Origin` 등)를 검사**하여, 요청이 동일 출처 정책에 부합하는지를 판단합니다.
- CORS 정책 위반 시, 웹 브라우저는 응답 처리를 차단합니다. 서버 측 처리(데이터베이스 작업 등)에는 영향을 주지 않습니다.

### 📃 리버스 프록시 서버를 사용하는 경우의 CORS 처리 방법

#### **: 클라이언트가 A 데이터를 포함한 요청을 보내고, 백엔드 서버는 이를 처리한 후 B 데이터를 응답으로 반환하는 상황 가정**

#### 1. 리버스 프록시 서버에 CORS 헤더를 추가하는 경우

1. **클라이언트 요청 발생**: 클라이언트(웹 브라우저)가 A 데이터를 포함하여 리버스 프록시(Nginx)에 요청
2. **리버스 프록시에서 요청 처리**: 리버스 프록시가 요청을 받고 설정에 따라 백엔드 서버로 전달
3. **백엔드 서버에서 요청 처리**: 백엔드 서버(Spring 애플리케이션 등)에서 요청을 받아 A 데이터를 DB에 저장하고, 응답으로 B 데이터를 생성
4. **응답이 리버스 프록시로 반환**: 백엔드 서버의 응답(B 데이터)이 리버스 프록시로 다시 전달
5. **리버스 프록시에서 CORS 헤더 추가**: 리버스 프록시가 응답에 CORS 관련 헤더(`Access-Control-Allow-Origin` 등)를 추가
6. **클라이언트에 응답 전달**: 수정된 응답이 클라이언트에게 전달
7. **웹 브라우저에서 CORS 검사**: 클라이언트(웹 브라우저)는 응답의 CORS 헤더를 검사하여 정책을 충족하는지 확인
8. **CORS 정책 충족 여부에 따른 처리**: 충족하면 B 데이터에 접근할 수 있고, 충족하지 않으면 접근이 차단

#### 2. 백엔드 서버에서 CORS 헤더를 추가한 경우:

1. **클라이언트 요청 발생**: 클라이언트(웹 브라우저)가 A 데이터를 포함하여 리버스 프록시(Nginx)에 요청

2. **리버스 프록시에서 요청 처리**: 리버스 프록시가 요청을 받고 설정에 따라 백엔드 서버로 전달

3. **백엔드 서버에서 요청 처리 및 CORS 헤더 추가**: 백엔드 서버에서는 A 데이터를 처리(예: DB 저장)하고, 응답으로 B 데이터를 반환하면서 응답에 CORS 헤더를 포함

4. **응답이 리버스 프록시를 거쳐 클라이언트로 전달**: 백엔드 서버의 응답이 리버스 프록시를 거쳐 클라이언트에게 전송. 리버스 프록시는 백엔드에서 설정한 CORS 헤더를 유지.

5. **웹 브라우저에서 CORS 검사**: 클라이언트(웹 브라우저)는 응답의 CORS 헤더를 검사하여 정책을 충족하는지 확인

6. **CORS 정책 충족 여부에 따른 처리**: 충족하면 B 데이터에 접근할 수 있고, 충족하지 않으면 접근이 차단

> 두 경우 모두 최종적으로 클라이언트에서 받은 응답의 CORS 헤더를 바탕으로 웹 브라우저가 CORS 정책 위반 여부를 판단하며, 이 과정에서 요청 출처와 응답의 `Access-Control-Allow-Origin` 헤더 값이 일치하는지가 핵심