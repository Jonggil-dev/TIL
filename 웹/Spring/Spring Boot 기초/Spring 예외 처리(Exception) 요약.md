# Spring 예외 처리(Exception) 내부 동작 과정 요약

### ▣ 스프링이 클라이언트의 요청을 수신하고 예외를 처리하는 과정 

- 요약 

  : 요청 -> WAS -> 디스패처 서블릿 -> 컨트롤러 -> 서비스 (예외 발생) -> (명시적 예외 처리 (try-catch구문) 없음) -> 컨트롤러로 예외 전파  -> (`@ExceptionHandler`) 예외 처리 -> (`@ExceptionHandler` 없으면) 컨트롤러에서 애플리케이션으로 예외 전파 -> `@ControllerAdvice`와 `@RestControllerAdvice` 에서 에러 처리 (에러 응답 형성) -> DispatcherServlet 에서 HTTP 응답으로 변환 -> 클라이언트 에러 수신

#### 1. HTTP 요청 수신
- **클라이언트에서 요청**: 사용자의 브라우저나 앱에서 HTTP 요청이 생성되어 서버로 전송됩니다.
- **WAS(웹 애플리케이션 서버)**: 예를 들어 Tomcat, Jetty 등의 WAS가 요청을 받고 기본적인 처리를 수행합니다. 요청의 메서드, URL, 헤더를 분석합니다.

#### 2. DispatcherServlet 도달
- **요청 라우팅**: Spring의 핵심 컨트롤러인 DispatcherServlet이 요청을 적절한 컨트롤러로 라우팅합니다. 이는 `HandlerMapping`을 사용하여 수행됩니다.

#### 3. 컨트롤러 처리
- **컨트롤러 실행**: 요청에 매핑된 컨트롤러 메서드가 실행되며, 필요한 서비스 메서드를 호출하여 비즈니스 로직을 수행합니다.

#### 4. 서비스 계층
- **비즈니스 로직 실행**: 서비스 계층에서 데이터베이스 접근, 외부 API 호출 등 실제 비즈니스 로직이 실행됩니다.

#### 5. 예외 발생 및 처리
- **예외 발생**: 비즈니스 로직(서비스 클래스) 처리 중 예외가 발생할 수 있습니다.
- **예외 전파**: 예외가 처리되지 않으면, 자동으로 컨트롤러로, 그리고 최종적으로 `DispatcherServlet`으로 전파됩니다.
  - **컨트롤러 내 처리**: 컨트롤러 내에서 예외를 처리하는 `@ExceptionHandler`가 없으면, 예외는 계속해서 전파됩니다.
  - **글로벌 예외 처리 (`@ControllerAdvice` 또는 `@RestControllerAdvice`)**: 컨트롤러를 벗어난 예외(컨트롤러에서 한 단계 상위로 throw 된 예외) 는 이 단계에서 잡혀 처리됩니다. `@ControllerAdvice`와 `@RestControllerAdvice`는 컨트롤러 계층보다 상위에서 동작하여 애플리케이션의 모든 컨트롤러에 걸쳐 예외를 포착하고, 적절한 HTTP 응답을 생성합니다.

#### 6. 응답 생성 및 전송
- **응답 생성**: 예외 처리기에서 생성된 응답 객체가 `DispatcherServlet`을 통해 HTTP 응답으로 변환되어 클라이언트에게 전송됩니다.

#### 특이사항
- **예외 자동 전파**: 서비스 계층에서 발생한 예외는 `try-catch`나 예외 처리기가 없으면 자동으로 호출 체인을 따라 컨트롤러, 그리고 DispatcherServlet을 거쳐 글로벌 예외 처리기로 전파됩니다.
