# React 환경변수 사용법

### 문제

- **React 빌드 후 백엔드 API 요청 주소 문제**

  - 빌드 후 환경 변수 파일을 구성해서 사용했던 백엔드 API 요청 URL이 로컬에서 테스트 했던거와는 다르게 바뀜.
  - 원인은 `env.config.js` 같은 파일을 환경 변수 관리에 사용해서 발생

  - `env.config.js` 파일이 빌드 과정에서 정적 파일로 간주돼 빌드 과정에서 원본 파일과는 다른 경로나 이름으로 접근해야 하는 상황이 발생함.

    > ### 정적 파일로 간주한다는 의미
    >
    > 웹 애플리케이션에서 "정적 파일"이란, 서버에 미리 저장되어 있고, 실행 시간에 따라 변하지 않는 파일들을 말합니다. 예를 들어, HTML, CSS, JavaScript 파일, 이미지 파일 등이 이에 해당합니다. 사용자의 요청에 따라 변경되지 않고, 그대로 제공되는 파일들이죠.
    >
    > `env.config.js`가 "정적 파일로 간주된다"는 말은, 빌드 과정에서 웹팩 같은 빌드 도구가 이 파일을 애플리케이션 로직의 일부가 아닌, 변경되지 않고 그대로 제공될 파일로 처리한다는 뜻입니다. **즉, 빌드 후의 애플리케이션에서는 이 파일이 코드의 일부로 실행되어 환경 변수를 제공하는 대신, 그냥 파일 하나로 존재하게 됩니다**. 따라서, 애플리케이션 로직에서 이 파일을 직접 참조하려 할 때 문제가 발생할 수 있습니다.
    >
    > **"정적 파일로 간주되지 않는다"는 것은 반대로, 파일이 애플리케이션의 로직이나 구성 요소로 활용되어 빌드 과정에서도 코드의 일부로 처리된다는 뜻**입니다. 환경 변수를 관리하는 파일이 이러한 방식으로 처리되어야 애플리케이션 실행 시 동적으로 환경 변수 값을 불러와 사용할 수 있습니다.
    >
    > ### 정적 파일로 간주됐을 때 문제가 발생하는 이유
    >
    > `env.config.js` 파일 같이 환경 설정을 담은 파일이 정적 파일로 간주되고 이러한 변환 과정을 거치면, 원본 파일과는 다른 경로나 이름으로 접근해야 하는 상황이 발생.
    >
    > 정적 파일로 간주되면 빌드 과정에서 아래와 같은 작업이 발생함
    >
    > 1. **파일 이름 변경**: 브라우저 캐싱 이슈를 방지하기 위해, 파일 이름에 해시(hash) 값을 추가하기도 함. 예를 들어, `env.config.js`가 `env.a6c8bb71d133eddb9d31.config.js` 같은 형태로 변경될 수 있음.
    >
    > 2. **파일 경로 변경**: 프로젝트 구조에 따라, 빌드 도구가 파일을 다른 디렉토리로 이동시킬 수 있음. 이럴 때 파일에 접근하는 경로도 함께 변경됨.
    >
    > 3. **정적 자원 처리**: 웹팩 같은 도구는 특정 파일을 정적 자원으로 처리하고, 이들을 웹 서버에서 접근 가능한 경로로 옮김. 이 과정에서 `public` 폴더나 비슷한 곳으로 파일이 이동되고, 접근 URL이 변경될 수 있음.
    >
    > 원래 의도했던 API 주소나 다른 설정 값에 접근하기 위해 설정 파일을 직접 참조하는 코드가 있었다면, 빌드 후에는 이 경로가 변경되어 예상치 못한 URL로 요청을 보내게 됨. 이러한 문제를 피하기 위해서는 환경 변수를 `.env` 파일과 같은 방식으로 관리하고, 빌드 과정에서 안정적으로 처리될 수 있도록 해야됨.

### 해결방법

- **환경 변수 사용**

  - 환경 변수를 사용할 땐, `.env` 파일에 `REACT_APP_` 접두사를 붙여 정의해야 함. 이 방법을 통해, 빌드 시 환경 변수가 애플리케이션 코드 내에서 접근 가능하게 됨.

- **구체적인 환경 변수 사용 방법**

  1. `.env` 파일 생성
     - 프로젝트의 루트 디렉토리(프로젝트 최상위 디렉토리)에 `.env` 파일을 생성

  2. 환경 변수 정의

     - `.env` 파일 안에 환경 변수를 정의할 때는 `REACT_APP_` 접두사를 사용. React는 `REACT_APP_`로 시작하는 환경 변수만을 인식하고, 빌드 과정에서 이를 처리함

       ```properties
       REACT_APP_API_URL=https://api.example.com
       ```

  3. 환경 변수 사용

     - `.env` 파일에 정의된 환경 변수들은 자동으로 `process.env` 객체에 할당되고 이 객체는 어플리케이션 전역에서 접근할 수 있기 때문에 **별도로 `import`할 필요 없이 직접 사용**

       ```properties
       const apiUrl = process.env.REACT_APP_API_URL;
       ```

  4. 환경에 따른 다른 `.env` 파일

     - React는 `.env`, `.env.local`, `.env.development`, `.env.test`, `.env.production` 등 여러 환경에 따른 `.env` 파일을 지원

       - `.env`: 모든 환경에서 기본으로 적용될 설정을 포함

       - `.env.local`: 로컬 개발 환경에서만 적용되며

       - `.env.development`, `.env.test`, `.env.production`: 각각 개발, 테스트, 프로덕션 환경에서 적용될 설정을 포함


  5. 프로젝트 재시작
     - 환경 변수를 추가하거나 변경한 후에는 React 개발 서버를 재시작해야 변경사항이 적용

  