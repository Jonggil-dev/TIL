# 자율 프로젝트 고민 사항 모음

### 1. Fcm 토큰의 경우 로그인 할 때 User 서버에서 요청 받지만, Notification 서버와 연결된 DB(몽고)로 저장해야 되는데 어떻게?

- 각 서버의 독립성을 생각해보면 자녀 ID와 Fcm 토큰을 Kafka에 넣고 Notification에서 수신해서 저장하도록 하는게 제일 바람직해 보임 -> 이 방법이 아니면 결국 Notification 서비스가 내려갔을 때 자녀 회원 가입에 영향을 미치게 됨

### 2. 회원 가입 시 소프트 딜리트 유저 확인하는 로직 추가 

- 탈퇴 유저의 LoginID, PhoneNumber, DeviceId는 다시 쓸 수 있어야 됨
- 구현 방법
  - **유니크 인덱스 수정 (필터링된 인덱스 또는 부분 인덱스 사용)**
    - 소프트 딜리트된 레코드에 대해 필드의 유니크 인덱스를 비활성화하고, 활성 사용자에 대해서만 유니크 제약 조건을 유지하는 방법

  - **로그인 ID 변경 (타임스탬프, UUID, 접두사 사용)**
    - 소프트 딜리트 처리 시, LoginId에 타임스탬프, UUID, 또는 특정 접두사를 추가하여 고유성을 깨뜨리는방법. 예를 들어, 사용자가 탈퇴하면 LoginId를 "deleted_" + 원래 LoginId로 변경할 수 있습니다

- 채택
  - **로그인 ID 변경 (타임스탬프(초단위 까지) 접두사 사용)**
  - 이유
    - 데이터베이스 구조나 인덱스 설정을 변경할 필요가 없어, 유니크 인덱스 관리가 쉬움
    - 특별한 데이터베이스 기능을 요구하지 않아 호환성이 좋음.

